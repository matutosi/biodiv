<html>
<head>
<!--  <script src="js/prototype.js"></script>    -->
<!--  <script src="js/fabtabulous.js"></script>  -->
<!--  <script src="js/tablekit.js"></script>     -->
<!--  <script src="sort.js"></script>     -->


<script src="table.js"></script>
<script src="date.js"></script>
<script src="download.js"></script>

<script src="table_setting.js"></script>
<script src="createOccurrenceTable.js"></script>
<script src="ranksort.js"></script>

<style>
  table{
    border-collapse:collapse;
  }
  table td{
    font-size   : 12pt;
    border-width: 1.5px 0px; /* line width: horizontal, vertical */
    border-color: #00552e;   /* line color    */
    border-style: solid;     /* line type     */
    padding     : 0.3em 1em; /* innder margin */
  }
  table th{
    cursor:pointer;
    background-color:#00552e;
    color:white;
    border-color: white;
    border-style: solid;
    padding: 0.3em 1em;
  }
</style>
</head>

<body>
<!--  タブ切り替え https://allabout.co.jp/gm/gc/23969/  -->

<p>
  <table id="table_setting">
  </table>

  <script>
  createSettingTable('table_setting')
  </script>

<!--  
  <input type="button" value="table setting"  onclick="createSettingTable('table_setting')" />
-->
</p>

<hr>

<p>
  <table id='occurrence'>
  </table>

  <script>
  createOccurrenceTable('occurrence')
  </script>
</p>

<input type="button" value="create occurrence table"  onclick="createOccurrenceTable(occ_tbl)" />
<input type="button" value="add row"  onclick="cloneRows(occ_tbl)" />
<input id="clone_n_row" type="number" value="5" step="1", min="1" max="20">
<input type="button" value="sort"  onclick="sortTable(occ_tbl)" />

<script>
let occ_tbl = 'occurrence';

// https://blog.ver001.com/javascript-table-sort/
let column_no = 0;       // now clicked
let column_no_prev = 0;  // previous clicked

  //document.querySelectorAll('#table_setting th').forEach(elm => {
  //  elm.onclick = function () {
  //    column_no = this.cellIndex;  // now clicked
  //    alert(column_no);
  //  };
  //});

document.querySelectorAll('#occurrence th').forEach(elm => {
  elm.onclick = function () {
  column_no = this.cellIndex;  // now clicked
      alert(column_no);
  };
});







function sortTable(id_table){
// var id_table = "occurrence";
  var table = document.getElementById(id_table);
  var trs = table.rows;
  var key = "occ_" + "no";
  var key_cols = string2Numeric(getInnerHTML(document.getElementsByClassName(key)));
  var new_order = rank(key_cols, order="desc");
  // th=0, add 1 to others
  for(let i=0; i<new_order.length; i++){ new_order[i]++; }
  new_order.unshift(0);
  var new_trs = sortByOrder(trs, new_order);
  for(let i=0; i<new_trs.length; i++){
    table.appendChild(new_trs[i]);
  }
}


// Convert string array to numeric array
//    Available when all element of array can be convert to numeric by Number().
//    Some element can NOT be converted, return input array.
function string2Numeric(array){
  var res_array = [];
  for(let i=0; i<array.length; i++){
    if(isNaN(Number(array[i]))){ return array; }
    res_array[i] = Number(array[i]);
  }
  return res_array;
}

// // // // // // // // // // // // // // // // // // // 
// 
//                 download用の値の取り出し
// 
// // // // // // // // // // // // // // // // // // // 
// 
//    if(row.children[i].firstChild.value === void 0){  // void 0 means undifined
//      row.children[i].innerHTML
//    } else {
//      row.children[i].firstChild.value
//    }
</script>



</body>
</html>
